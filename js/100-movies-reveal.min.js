let sfxMuted=!1;const panelSmarts=function(t,e){const n=t.parentElement,o=n.querySelector("img");let i=new Image;i.addEventListener("load",(function(){t.width=i.width,t.height=i.height;const s=t.width*t.height;o.setAttribute("width",String(t.width)),o.setAttribute("height",String(t.height));let a=0;const c=t.getContext("2d",{willReadFrequently:!0});c.drawImage(i,0,0,t.width,t.height),c.save();const d="Waiting for something amazing to happen...",u="Well done, you claim to have watched 100% of the entirety of this movie!",r=n.parentElement.querySelector(".controls"),l=r.querySelector(".icon-cancel-circle");l.setAttribute("title","Restore the scratchable layer!");const h=r.querySelector(".icon-forward2");h.setAttribute("title","Scratch this movie off the lazy way!");const m=n.getAttribute("data-no");let f=parseInt(n.getAttribute("data-watched")),p=null;f?(p=r.querySelector(".icon-checkmark2"),p.setAttribute("title",u)):(p=r.querySelector(".icon-neutral"),p.setAttribute("title",d));function w(){sfxMuted||soundbox.play("scratching",null,null,!0),p.classList.remove("icon-neutral"),p.classList.add("icon-baffled"),p.setAttribute("title","What do you think you're doing?!"),l.classList.remove("hide"),k()}function v(){clearTimeout(a),c.closePath(),x()?S():window.soundbox.stop_all()}function g(e,n){const o=t.getBoundingClientRect();return{x:Math.floor((e-o.left)/(o.right-o.left)*t.width),y:Math.floor((n-o.top)/(o.bottom-o.top)*t.height)}}function b(e,n){c.globalCompositeOperation="destination-out",c.lineJoin="round",c.lineCap="round",c.fillStyle="#000";const o=c.canvas.clientWidth,i=c.canvas.clientHeight,s=t.width/o*4,a=t.height/i*8;c.beginPath(),c.arc(e,n,s+a,0,2*Math.PI),c.closePath(),c.fill(),c.beginPath(),c.moveTo(e,n)}function L(o){ajaxPost(encodeURI("action="+o+"&listID="+e+"&movieNo="+m),(function(e){"added"===e?(n.setAttribute("data-watched","1"),f=1):"removed"===e&&(n.setAttribute("data-watched","0"),f=0);const o=t.closest(".grid-container.full"),i=o.querySelector(".watched"),s=parseInt(o.querySelector(".total").textContent);let a=parseInt(i.textContent);a=f?a+1:a-1,i.textContent=String(a),a===s&&(muteAudio(),fireworksCanvas.classList.remove("hide"),fireworks.start(),cancelButton.classList.remove("hide"))}))}function y(){const e=c.getImageData(0,0,t.width,t.height);let n=0;for(let t=0,o=e.data.length;t<o;t+=4)0===e.data[t]&&0===e.data[t+1]&&0===e.data[t+2]&&0===e.data[t+3]&&n++;return n/s*100}function x(){return y()>90||((y()>35||n.classList.contains("multi-img"))&&h.classList.remove("hide"),!1)}function S(){window.soundbox.stop_all(),c.clearRect(0,0,t.width,t.height),t.classList.add("hide"),sfxMuted||soundbox.play("pickup7a"),h.classList.add("hide"),p.classList.remove("icon-baffled"),p.classList.add("icon-checkmark2"),p.setAttribute("title",u),f||L("add")}function k(){a=setTimeout((function(){x()?(clearTimeout(a),S()):k()}),1500)}l.addEventListener("click",(function(){c.restore(),c.drawImage(i,0,0,t.width,t.height),c.save(),sfxMuted||soundbox.play("pickup7b"),l.classList.add("hide"),h.classList.add("hide"),p.classList.remove("icon-checkmark2","icon-baffled"),p.classList.add("icon-neutral"),p.setAttribute("title",d),t.classList.remove("hide"),f&&L("remove")})),h.addEventListener("click",(function(){S(),h.classList.add("hide")})),t.addEventListener("mousedown",w),t.addEventListener("mouseup",v),t.addEventListener("mousemove",(function(t){const e=g(t.clientX,t.clientY);var n;("buttons"in(n=t)?1===n.buttons:"which"in n?1===n.which:1===n.button)&&b(e.x,e.y)}),!1),t.addEventListener("touchstart",w,{passive:!0}),t.addEventListener("touchend",v),t.addEventListener("touchmove",(function(t){t.preventDefault();const e=t.targetTouches[0];if(e){const t=g(e.clientX,e.clientY);b(t.x,t.y)}}),{passive:!0})})),i.crossOrigin="Anonymous",i.src=o.src},ajaxPost=function(t,e){const n=new XMLHttpRequest;n.open("POST","./"),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.onload=function(){200===n.status&&"failed"===n.responseText?alert("Something went wrong.  Response was: "+n.responseText):200!==n.status?alert("Request failed.  Returned status of: "+n.status):void 0!==e&&e(n.responseText)},n.send(t)},playBtnSfx=function(){if(!sfxMuted){const t=["comp11","comp12"],e=Math.floor(Math.random()*t.length);soundbox.play(t[e])}},switchTab=function(t){const e=document.getElementsByClassName("tabmenu");for(let n=0;n<e.length;n++)e[n].removeAttribute("aria-selected"),e[n].getAttribute("data-list_id")===t&&e[n].setAttribute("aria-selected","true")},loadScript=function(t,e){const n=document.createElement("script");n.src=t,document.body.appendChild(n),e&&(n.onreadystatechange=e,n.onload=e)},initRouting=function(){const t=document.querySelectorAll(".tabmenu");let e=[];for(let n=1;n<t.length+1;n++)e.push(new Route(String(n),"?lid="+String(n),1===n));new Router(e)},addGridEvents=function(){document.querySelectorAll(".cards-100-top").forEach((function(t){const e=t.nextElementSibling,n=t.querySelector(".waiting"),o=t.querySelector(".userCode > input"),i=t.querySelector(".button");o.addEventListener("keyup",(function(t){if("Enter"===t.key){n.classList.remove("hide"),i.classList.add("hide");const t=o.getAttribute("data-code");ajaxPost(encodeURI("codeInput="+o.value+"&listID="+e.dataset.id),(function(e){e!==t.toUpperCase()?document.location.reload(!0):(i.classList.remove("hide"),n.classList.add("hide"),o.value=t)}))}})),i.addEventListener("click",(function(){playBtnSfx(),n.classList.remove("hide"),i.classList.add("hide"),ajaxPost(encodeURI("codeRequest=1&listID="+e.dataset.id),(function(){document.location.reload(!0)}))}));e.querySelectorAll("canvas").forEach((function(t){panelSmarts(t,e.dataset.id)})),switchTab(e.dataset.id),setTimeout((function(){e.classList.remove("hide"),n.classList.add("hide")}),500)}))},isOverflown=function(t){return t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth},path="/100-movies/assets/sound/";let fireworksCanvas,fireworks;const initFireworks=function(){const t=document.querySelector(".master-container");fireworks=new Fireworks(t,{sound:{enabled:!1,files:[path+"explosion0.mp3",path+"explosion1.mp3",path+"explosion2.mp3"]}}),fireworksCanvas=document.querySelector(".master-container > canvas"),fireworksCanvas.height=window.innerHeight,fireworks.setSize(),fireworksCanvas.classList.add("fireworks"),fireworksCanvas.classList.add("hide")},cancelButton=document.getElementById("cancel-btn"),muteButton=document.getElementById("mute-btn"),muteAudio=function(){window.soundbox.stop_all(),sfxMuted=1,fireworks.setOptions({sound:{enabled:!1}}),muteButton.classList.remove("icon-volume-high"),muteButton.classList.add("icon-volume-mute2"),muteButton.title="Unmute"},enableAudio=function(){sfxMuted=0,fireworks.setOptions({sound:{enabled:!0}}),playBtnSfx(),muteButton.classList.remove("icon-volume-mute2"),muteButton.classList.add("icon-volume-high"),muteButton.title="Mute"};!function(){document.querySelectorAll(".tabmenu").forEach((function(t){t.addEventListener("click",(function(){playBtnSfx(),switchTab(this.getAttribute("data-list_id")),document.getElementById("foot-criteria").textContent=this.getAttribute("data-foot_criteria");const t="books"===this.getAttribute("data-list_type")?"google-books":"themoviedb";document.getElementById("foot-logo").setAttribute("class",t+"-logo")}))})),muteButton.classList.contains("icon-volume-mute2")&&(sfxMuted=!0),muteButton.addEventListener("click",(function(){muteButton.classList.contains("icon-volume-high")?muteAudio():(sfxMuted=0,fireworks.setOptions({sound:{enabled:!0}}),playBtnSfx(),muteButton.classList.remove("icon-volume-mute2"),muteButton.classList.add("icon-volume-high"),muteButton.title="Mute"),ajaxPost(encodeURI("muteSfx="+sfxMuted))})),cancelButton.addEventListener("click",(function(){cancelButton.classList.add("hide"),fireworks.stop(),fireworksCanvas.classList.add("hide")})),window.addEventListener("load",(function(){window.soundbox=new SoundBox,soundbox.load("scratching",path+"Scratching-Paper.mp3").then((function(t){})),soundbox.load("pickup7a",path+"Pickup_Coin7a.mp3").then((function(t){})),soundbox.load("pickup7b",path+"Pickup_Coin7b.mp3").then((function(t){})),soundbox.load("comp11",path+"STcomp011.wav").then((function(t){})),soundbox.load("comp12",path+"STcomp012.wav").then((function(t){}))}));const t=document.querySelector(".tabs");(isOverflown(t)||screen.width<550)&&t.classList.add("show-menu-btn"),window.addEventListener("resize",(function(){isOverflown(t)||screen.width<550?t.classList.add("show-menu-btn"):(t.classList.remove("show-menu-btn"),t.classList.remove("show-menu-items"))}));document.querySelector(".icon-menu").addEventListener("click",(function(){t.classList.contains("show-menu-items")?t.classList.remove("show-menu-items"):t.classList.add("show-menu-items")})),loadScript("./js/routing.min.js",initRouting),loadScript("./js/fireworks-js_v1.4.1.js",initFireworks)}();