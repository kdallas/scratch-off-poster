function panelSmarts(y,x){var E=y.parentElement,S=new Image;S.addEventListener("load",function(){function t(){sfxMuted||soundbox.play("scratching",null,null,!0),L.classList.remove("icon-neutral"),L.classList.add("icon-baffled"),L.setAttribute("title",v),p.classList.remove("hide"),function t(){l=setTimeout(function(){s()?(clearTimeout(l),d()):t()},1500)}()}function e(){clearTimeout(l),u.closePath(),s()?d():window.soundbox.stop_all()}function n(t,e){var o=y.getBoundingClientRect();return{x:Math.floor((t-o.left)/(o.right-o.left)*y.width),y:Math.floor((e-o.top)/(o.bottom-o.top)*y.height)}}function a(t,e){u.globalCompositeOperation="destination-out",u.lineJoin="round",u.lineCap="round",u.fillStyle="#000",u.beginPath(),u.arc(t-5,e+10,r,0,2*Math.PI),u.closePath(),u.fill(),u.beginPath(),u.moveTo(t-5,e+10)}function o(t){ajaxPost(encodeURI("action="+t+"&listID="+x+"&movieNo="+b),function(t){"added"===t?(E.setAttribute("data-watched","1"),w=1):"removed"===t&&(E.setAttribute("data-watched","0"),w=0);var e=y.closest(".grid-container.full").querySelector(".watched"),o=parseInt(e.textContent);e.textContent=w?o+1:o-1})}function i(){for(var t=0,e=u.getImageData(0,0,y.width,y.height),o=0,n=e.data.length;o<n;o+=4)0===e.data[o]&&0===e.data[o+1]&&0===e.data[o+2]&&0===e.data[o+3]&&t++;return t/c*100}function s(){return 90<i()||((35<i()||E.classList.contains("multi-img"))&&g.classList.remove("hide"),!1)}function d(){window.soundbox.stop_all(),u.clearRect(0,0,y.width,y.height),y.classList.add("hide"),sfxMuted||soundbox.play("pickup7a"),g.classList.add("hide"),L.classList.remove("icon-baffled"),L.classList.add("icon-checkmark2"),L.setAttribute("title",m),w||o("add")}y.width=S.width,y.height=S.height;var c=y.width*y.height,r=15,l=0,u=y.getContext("2d");u.drawImage(S,0,0,y.width,y.height),u.save();var h="Waiting for something amazing to happen...",m="Well done, you claim to have watched 100% of the entirety of this movie!",v="What do you think you're doing?!",f=E.parentElement.querySelector(".controls"),p=f.querySelector(".icon-cancel-circle");p.setAttribute("title","Restore the scratchable layer!");var g=f.querySelector(".icon-forward2");g.setAttribute("title","Scratch this movie off the lazy way!");var b=E.getAttribute("data-no"),w=parseInt(E.getAttribute("data-watched")),L=null;w?(L=f.querySelector(".icon-checkmark2")).setAttribute("title",m):(L=f.querySelector(".icon-neutral")).setAttribute("title",h),p.addEventListener("click",function(){u.restore(),u.drawImage(S,0,0,y.width,y.height),u.save(),sfxMuted||soundbox.play("pickup7b"),p.classList.add("hide"),g.classList.add("hide"),L.classList.remove("icon-checkmark2","icon-baffled"),L.classList.add("icon-neutral"),L.setAttribute("title",h),y.classList.remove("hide"),w&&o("remove")}),g.addEventListener("click",function(){d(),g.classList.add("hide")}),y.addEventListener("mousedown",t),y.addEventListener("mouseup",e),y.addEventListener("mousemove",function(t){var e,o=n(t.clientX,t.clientY);("buttons"in(e=t)?1===e.buttons:"which"in e?1===e.which:1===e.button)&&a(o.x,o.y)},!1),y.addEventListener("touchstart",t),y.addEventListener("touchend",e),y.addEventListener("touchmove",function(t){t.preventDefault();var e=t.targetTouches[0];if(e){var o=n(e.pageX,e.pageY);a(o.x,o.y)}},!1)}),S.crossOrigin="Anonymous",S.src=E.querySelector("img").src}function switchTab(t,e){if(!sfxMuted){var o=["comp11","comp12"],n=Math.floor(Math.random()*o.length);soundbox.play(o[n])}var a,i=document.getElementsByClassName("tabcontent");for(a=0;a<i.length;a++)i[a].style.display="none";for(document.getElementById(e).style.display="block",i=document.getElementsByClassName("tabmenu"),a=0;a<i.length;a++)i[a].removeAttribute("aria-selected");var s=document.getElementById(t);s.setAttribute("aria-selected",!0),ajaxPost(encodeURI("activeListID="+s.dataset.list_id))}var sfxMuted=!1,ajaxPost=function(t,e){var o=new XMLHttpRequest;o.open("POST","./"),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.onload=function(){200===o.status&&"failed"===o.responseText?alert("Something went wrong.  Response was: "+o.responseText):200!==o.status?alert("Request failed.  Returned status of: "+o.status):void 0!==e&&e(o.responseText)},o.send(t)};!function(){var t=document.querySelectorAll(".cards-100-top");t.forEach(function(t){var o=t.nextElementSibling,n=t.querySelector(".waiting"),a=t.querySelector(".userCode > input"),i=t.querySelector(".button");a.addEventListener("keyup",function(t){if("Enter"===t.key){n.classList.remove("hide"),i.classList.add("hide");var e=a.getAttribute("data-code");ajaxPost(encodeURI("codeInput="+a.value+"&listID="+o.dataset.id),function(t){t!==e.toUpperCase()?document.location.reload(!0):(i.classList.remove("hide"),n.classList.add("hide"),a.value=e)})}}),i.addEventListener("click",function(){n.classList.remove("hide"),i.classList.add("hide"),ajaxPost(encodeURI("codeRequest=1&listID="+o.dataset.id),function(){document.location.reload(!0)})}),o.querySelectorAll("canvas").forEach(function(t){panelSmarts(t,o.dataset.id)})}),document.querySelectorAll(".tabmenu").forEach(function(t){t.addEventListener("click",function(){switchTab(this.getAttribute("id"),this.getAttribute("data-id"))})});var e=document.getElementById("mute-btn");e.addEventListener("click",function(){e.classList.contains("icon-volume-high")?(window.soundbox.stop_all(),sfxMuted=!0,e.classList.remove("icon-volume-high"),e.classList.add("icon-volume-mute2"),e.title="Unmute"):(sfxMuted=!1,e.classList.remove("icon-volume-mute2"),e.classList.add("icon-volume-high"),e.title="Mute")}),window.addEventListener("load",function(){window.soundbox=new SoundBox,soundbox.load("scratching","/100-movies/assets/sound/Scratching-Paper.mp3"),soundbox.load("pickup7a","/100-movies/assets/sound/Pickup_Coin7a.mp3"),soundbox.load("pickup7b","/100-movies/assets/sound/Pickup_Coin7b.mp3"),soundbox.load("comp11","/100-movies/assets/sound/STcomp011.wav"),soundbox.load("comp12","/100-movies/assets/sound/STcomp012.wav"),t.forEach(function(t){t.nextElementSibling.classList.remove("hide"),t.querySelector(".waiting").classList.add("hide")})})}();