function panelSmarts(L){var x=L.parentElement,S=new Image;S.addEventListener("load",function(){function t(){soundbox.play("scratching",null,null,!0),g.classList.remove("icon-neutral"),g.classList.add("icon-baffled"),g.setAttribute("title",v),m.classList.remove("hide"),function t(){u=setTimeout(function(){s()?(clearTimeout(u),r()):t()},1500)}()}function e(){clearTimeout(u),l.closePath(),s()?r():window.soundbox.stop_all()}function n(t,e){var o=L.getBoundingClientRect();return{x:Math.floor((t-o.left)/(o.right-o.left)*L.width),y:Math.floor((e-o.top)/(o.bottom-o.top)*L.height)}}function a(t,e){l.globalCompositeOperation="destination-out",l.lineJoin="round",l.lineCap="round",l.fillStyle="#000",l.beginPath(),l.arc(t-5,e+10,d,0,2*Math.PI),l.closePath(),l.fill(),l.beginPath(),l.moveTo(t-5,e+10)}function o(t){ajaxPost(encodeURI("action="+t+"&movieNo="+b),function(t){"added"==t?(x.setAttribute("data-watched","1"),y=1):"removed"==t&&(x.setAttribute("data-watched","0"),y=0),updateTop(y)})}function i(){for(var t=0,e=l.getImageData(0,0,L.width,L.height),o=0,n=e.data.length;o<n;o+=4)0===e.data[o]&&0===e.data[o+1]&&0===e.data[o+2]&&0===e.data[o+3]&&t++;return t/c*100}function s(){return 90<i()||((35<i()||x.classList.contains("multi-img"))&&w.classList.remove("hide"),!1)}function r(){window.soundbox.stop_all(),l.clearRect(0,0,L.width,L.height),L.classList.add("hide"),soundbox.play("pickup7a"),w.classList.add("hide"),g.classList.remove("icon-baffled"),g.classList.add("icon-checkmark2"),g.setAttribute("title",p),y||o("add")}L.width=S.width,L.height=S.height;var c=L.width*L.height,d=15,u=0,l=L.getContext("2d");l.drawImage(S,0,0,L.width,L.height),l.save();var h="Waiting for something amazing to happen...",p="Well done, you claim to have watched 100% of the entirety of this movie!",v="What do you think you're doing?!",f=x.parentElement.querySelector(".controls"),m=f.querySelector(".icon-cancel-circle");m.setAttribute("title","Restore the scratchable layer!");var w=f.querySelector(".icon-forward2");w.setAttribute("title","Scratch this movie off the lazy way!");var g,b=x.getAttribute("data-no"),y=parseInt(x.getAttribute("data-watched"));y?(g=f.querySelector(".icon-checkmark2")).setAttribute("title",p):(g=f.querySelector(".icon-neutral")).setAttribute("title",h),m.addEventListener("click",function(){l.restore(),l.drawImage(S,0,0,L.width,L.height),l.save(),soundbox.play("pickup7b"),m.classList.add("hide"),w.classList.add("hide"),g.classList.remove("icon-checkmark2","icon-baffled"),g.classList.add("icon-neutral"),g.setAttribute("title",h),L.classList.remove("hide"),y&&o("remove")}),w.addEventListener("click",function(){r(),w.classList.add("hide")}),L.addEventListener("mousedown",t),L.addEventListener("mouseup",e),L.addEventListener("mousemove",function(t){var e,o=n(t.clientX,t.clientY);1==("buttons"in(e=t)?1===e.buttons:"which"in e?1===e.which:1===e.button)&&a(o.x,o.y)},!1),L.addEventListener("touchstart",t),L.addEventListener("touchend",e),L.addEventListener("touchmove",function(t){t.preventDefault();var e=t.targetTouches[0];if(e){var o=n(e.pageX,e.pageY);a(o.x,o.y)}},!1)}),S.crossOrigin="Anonymous",S.src=x.querySelector("img").src}function updateTop(t){var e=parseInt(watchCount.textContent);watchCount.textContent=t?e+1:e-1}function ajaxPost(t,e){var o=new XMLHttpRequest;o.open("POST","./"),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.onload=function(){200===o.status&&"failed"==o.responseText?alert("Something went wrong.  Response was: "+o.responseText):200!==o.status?alert("Request failed.  Returned status of: "+o.status):e(o.responseText)},o.send(t)}var watchCount=null,totalMovies=null;!function(){var e=document.querySelector(".cards-100-top");watchCount=e.querySelector(".watched"),totalMovies=e.querySelector(".total");var o=e.querySelector(".userCode > input");o.addEventListener("keyup",function(t){if("Enter"===t.key){var e=o.getAttribute("data-code");ajaxPost(encodeURI("codeInput="+o.value),function(t){t!==e.toUpperCase()&&document.location.reload(!0)})}}),e.querySelector(".button").addEventListener("click",function(t){ajaxPost(encodeURI("codeRequest=1"),function(t){document.location.reload(!0)})});var n=document.querySelector(".cards-100-gallery");n.querySelectorAll("canvas").forEach(function(t){panelSmarts(t)}),window.addEventListener("load",function(t){window.soundbox=new SoundBox,soundbox.load("scratching","/100-movies/assets/sound/Scratching-Paper.mp3"),soundbox.load("pickup7a","/100-movies/assets/sound/Pickup_Coin7a.mp3"),soundbox.load("pickup7b","/100-movies/assets/sound/Pickup_Coin7b.mp3"),n.classList.remove("hide"),e.querySelector(".waiting").classList.add("hide")})}();