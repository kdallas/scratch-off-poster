function panelSmarts(y){var x=y.parentElement,S=new Image;S.addEventListener("load",function(){function t(){sfxMuted||soundbox.play("scratching",null,null,!0),b.classList.remove("icon-neutral"),b.classList.add("icon-baffled"),b.setAttribute("title",v),p.classList.remove("hide"),function t(){u=setTimeout(function(){s()?(clearTimeout(u),c()):t()},1500)}()}function e(){clearTimeout(u),l.closePath(),s()?c():window.soundbox.stop_all()}function a(t,e){var o=y.getBoundingClientRect();return{x:Math.floor((t-o.left)/(o.right-o.left)*y.width),y:Math.floor((e-o.top)/(o.bottom-o.top)*y.height)}}function n(t,e){l.globalCompositeOperation="destination-out",l.lineJoin="round",l.lineCap="round",l.fillStyle="#000",l.beginPath(),l.arc(t-5,e+10,r,0,2*Math.PI),l.closePath(),l.fill(),l.beginPath(),l.moveTo(t-5,e+10)}function o(t){ajaxPost(encodeURI("action="+t+"&movieNo="+w),function(t){"added"===t?(x.setAttribute("data-watched","1"),L=1):"removed"===t&&(x.setAttribute("data-watched","0"),L=0),updateTop(L)})}function i(){for(var t=0,e=l.getImageData(0,0,y.width,y.height),o=0,a=e.data.length;o<a;o+=4)0===e.data[o]&&0===e.data[o+1]&&0===e.data[o+2]&&0===e.data[o+3]&&t++;return t/d*100}function s(){return 90<i()||((35<i()||x.classList.contains("multi-img"))&&g.classList.remove("hide"),!1)}function c(){window.soundbox.stop_all(),l.clearRect(0,0,y.width,y.height),y.classList.add("hide"),sfxMuted||soundbox.play("pickup7a"),g.classList.add("hide"),b.classList.remove("icon-baffled"),b.classList.add("icon-checkmark2"),b.setAttribute("title",m),L||o("add")}y.width=S.width,y.height=S.height;var d=y.width*y.height,r=15,u=0,l=y.getContext("2d");l.drawImage(S,0,0,y.width,y.height),l.save();var h="Waiting for something amazing to happen...",m="Well done, you claim to have watched 100% of the entirety of this movie!",v="What do you think you're doing?!",f=x.parentElement.querySelector(".controls"),p=f.querySelector(".icon-cancel-circle");p.setAttribute("title","Restore the scratchable layer!");var g=f.querySelector(".icon-forward2");g.setAttribute("title","Scratch this movie off the lazy way!");var w=x.getAttribute("data-no"),L=parseInt(x.getAttribute("data-watched")),b=null;L?(b=f.querySelector(".icon-checkmark2")).setAttribute("title",m):(b=f.querySelector(".icon-neutral")).setAttribute("title",h),p.addEventListener("click",function(){l.restore(),l.drawImage(S,0,0,y.width,y.height),l.save(),sfxMuted||soundbox.play("pickup7b"),p.classList.add("hide"),g.classList.add("hide"),b.classList.remove("icon-checkmark2","icon-baffled"),b.classList.add("icon-neutral"),b.setAttribute("title",h),y.classList.remove("hide"),L&&o("remove")}),g.addEventListener("click",function(){c(),g.classList.add("hide")}),y.addEventListener("mousedown",t),y.addEventListener("mouseup",e),y.addEventListener("mousemove",function(t){var e,o=a(t.clientX,t.clientY);("buttons"in(e=t)?1===e.buttons:"which"in e?1===e.which:1===e.button)&&n(o.x,o.y)},!1),y.addEventListener("touchstart",t),y.addEventListener("touchend",e),y.addEventListener("touchmove",function(t){t.preventDefault();var e=t.targetTouches[0];if(e){var o=a(e.pageX,e.pageY);n(o.x,o.y)}},!1)}),S.crossOrigin="Anonymous",S.src=x.querySelector("img").src}function updateTop(t){var e=parseInt(watchCount.textContent);watchCount.textContent=t?e+1:e-1}function ajaxPost(t,e){var o=new XMLHttpRequest;o.open("POST","./"),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.onload=function(){200===o.status&&"failed"===o.responseText?alert("Something went wrong.  Response was: "+o.responseText):200!==o.status?alert("Request failed.  Returned status of: "+o.status):e(o.responseText)},o.send(t)}var watchCount=null,totalMovies=null,sfxMuted=!1;!function(){var t=document.querySelector(".cards-100-top");watchCount=t.querySelector(".watched"),totalMovies=t.querySelector(".total");var o=t.querySelector(".waiting"),a=t.querySelector(".userCode > input"),n=t.querySelector(".button"),e=t.querySelector("#mute-btn");a.addEventListener("keyup",function(t){if("Enter"===t.key){o.classList.remove("hide"),n.classList.add("hide");var e=a.getAttribute("data-code");ajaxPost(encodeURI("codeInput="+a.value),function(t){t!==e.toUpperCase()?document.location.reload(!0):(n.classList.remove("hide"),o.classList.add("hide"),a.value=e)})}}),n.addEventListener("click",function(){o.classList.remove("hide"),n.classList.add("hide"),ajaxPost(encodeURI("codeRequest=1"),function(){document.location.reload(!0)})}),e.addEventListener("click",function(){e.classList.contains("icon-volume-high")?(window.soundbox.stop_all(),sfxMuted=!0,e.classList.remove("icon-volume-high"),e.classList.add("icon-volume-mute2"),e.title="Unmute"):(sfxMuted=!1,e.classList.remove("icon-volume-mute2"),e.classList.add("icon-volume-high"),e.title="Mute")});var i=document.querySelector(".cards-100-gallery");i.querySelectorAll("canvas").forEach(function(t){panelSmarts(t)}),window.addEventListener("load",function(){window.soundbox=new SoundBox,soundbox.load("scratching","/100-movies/assets/sound/Scratching-Paper.mp3"),soundbox.load("pickup7a","/100-movies/assets/sound/Pickup_Coin7a.mp3"),soundbox.load("pickup7b","/100-movies/assets/sound/Pickup_Coin7b.mp3"),i.classList.remove("hide"),o.classList.add("hide")})}();