function panelSmarts(L,x){var S=L.parentElement,E=new Image;E.addEventListener("load",function(){function t(){sfxMuted||soundbox.play("scratching",null,null,!0),y.classList.remove("icon-neutral"),y.classList.add("icon-baffled"),y.setAttribute("title",f),p.classList.remove("hide"),function t(){r=setTimeout(function(){s()?(clearTimeout(r),d()):t()},1500)}()}function e(){clearTimeout(r),u.closePath(),s()?d():window.soundbox.stop_all()}function n(t,e){var o=L.getBoundingClientRect();return{x:Math.floor((t-o.left)/(o.right-o.left)*L.width),y:Math.floor((e-o.top)/(o.bottom-o.top)*L.height)}}function a(t,e){u.globalCompositeOperation="destination-out",u.lineJoin="round",u.lineCap="round",u.fillStyle="#000",u.beginPath(),u.arc(t-5,e+10,l,0,2*Math.PI),u.closePath(),u.fill(),u.beginPath(),u.moveTo(t-5,e+10)}function o(t){ajaxPost(encodeURI("action="+t+"&listID="+x+"&movieNo="+b),function(t){"added"===t?(S.setAttribute("data-watched","1"),w=1):"removed"===t&&(S.setAttribute("data-watched","0"),w=0);var e=L.closest(".grid-container.full").querySelector(".watched"),o=parseInt(e.textContent);e.textContent=w?o+1:o-1})}function i(){for(var t=0,e=u.getImageData(0,0,L.width,L.height),o=0,n=e.data.length;o<n;o+=4)0===e.data[o]&&0===e.data[o+1]&&0===e.data[o+2]&&0===e.data[o+3]&&t++;return t/c*100}function s(){return 90<i()||((35<i()||S.classList.contains("multi-img"))&&g.classList.remove("hide"),!1)}function d(){window.soundbox.stop_all(),u.clearRect(0,0,L.width,L.height),L.classList.add("hide"),sfxMuted||soundbox.play("pickup7a"),g.classList.add("hide"),y.classList.remove("icon-baffled"),y.classList.add("icon-checkmark2"),y.setAttribute("title",m),w||o("add")}L.width=E.width,L.height=E.height;var c=L.width*L.height,l=15,r=0,u=L.getContext("2d");u.drawImage(E,0,0,L.width,L.height),u.save();var h="Waiting for something amazing to happen...",m="Well done, you claim to have watched 100% of the entirety of this movie!",f="What do you think you're doing?!",v=S.parentElement.querySelector(".controls"),p=v.querySelector(".icon-cancel-circle");p.setAttribute("title","Restore the scratchable layer!");var g=v.querySelector(".icon-forward2");g.setAttribute("title","Scratch this movie off the lazy way!");var b=S.getAttribute("data-no"),w=parseInt(S.getAttribute("data-watched")),y=null;w?(y=v.querySelector(".icon-checkmark2")).setAttribute("title",m):(y=v.querySelector(".icon-neutral")).setAttribute("title",h),p.addEventListener("click",function(){u.restore(),u.drawImage(E,0,0,L.width,L.height),u.save(),sfxMuted||soundbox.play("pickup7b"),p.classList.add("hide"),g.classList.add("hide"),y.classList.remove("icon-checkmark2","icon-baffled"),y.classList.add("icon-neutral"),y.setAttribute("title",h),L.classList.remove("hide"),w&&o("remove")}),g.addEventListener("click",function(){d(),g.classList.add("hide")}),L.addEventListener("mousedown",t),L.addEventListener("mouseup",e),L.addEventListener("mousemove",function(t){var e,o=n(t.clientX,t.clientY);("buttons"in(e=t)?1===e.buttons:"which"in e?1===e.which:1===e.button)&&a(o.x,o.y)},!1),L.addEventListener("touchstart",t),L.addEventListener("touchend",e),L.addEventListener("touchmove",function(t){t.preventDefault();var e=t.targetTouches[0];if(e){var o=n(e.pageX,e.pageY);a(o.x,o.y)}},!1)}),E.crossOrigin="Anonymous",E.src=S.querySelector("img").src}function switchTab(t,e){playBtnSfx();var o,n=document.getElementsByClassName("tabcontent");for(o=0;o<n.length;o++)n[o].style.display="none";for(document.getElementById(e).style.display="block",n=document.getElementsByClassName("tabmenu"),o=0;o<n.length;o++)n[o].removeAttribute("aria-selected");var a=document.getElementById(t);a.setAttribute("aria-selected",!0),ajaxPost(encodeURI("activeListID="+a.dataset.list_id))}var sfxMuted=!1,ajaxPost=function(t,e){var o=new XMLHttpRequest;o.open("POST","./"),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.onload=function(){200===o.status&&"failed"===o.responseText?alert("Something went wrong.  Response was: "+o.responseText):200!==o.status?alert("Request failed.  Returned status of: "+o.status):void 0!==e&&e(o.responseText)},o.send(t)},playBtnSfx=function(){if(!sfxMuted){var t=["comp11","comp12"],e=Math.floor(Math.random()*t.length);soundbox.play(t[e])}};!function(){var t=document.querySelectorAll(".cards-100-top");t.forEach(function(t){var o=t.nextElementSibling,n=t.querySelector(".waiting"),a=t.querySelector(".userCode > input"),i=t.querySelector(".button");a.addEventListener("keyup",function(t){if("Enter"===t.key){n.classList.remove("hide"),i.classList.add("hide");var e=a.getAttribute("data-code");ajaxPost(encodeURI("codeInput="+a.value+"&listID="+o.dataset.id),function(t){t!==e.toUpperCase()?document.location.reload(!0):(i.classList.remove("hide"),n.classList.add("hide"),a.value=e)})}}),i.addEventListener("click",function(){playBtnSfx(),n.classList.remove("hide"),i.classList.add("hide"),ajaxPost(encodeURI("codeRequest=1&listID="+o.dataset.id),function(){document.location.reload(!0)})}),o.querySelectorAll("canvas").forEach(function(t){panelSmarts(t,o.dataset.id)})}),document.querySelectorAll(".tabmenu").forEach(function(t){t.addEventListener("click",function(){switchTab(this.getAttribute("id"),this.getAttribute("data-id"))})});var e=document.getElementById("mute-btn");e.addEventListener("click",function(){e.classList.contains("icon-volume-high")?(window.soundbox.stop_all(),sfxMuted=!0,e.classList.remove("icon-volume-high"),e.classList.add("icon-volume-mute2"),e.title="Unmute"):(sfxMuted=!1,e.classList.remove("icon-volume-mute2"),e.classList.add("icon-volume-high"),e.title="Mute")}),window.addEventListener("load",function(){window.soundbox=new SoundBox,soundbox.load("scratching","/100-movies/assets/sound/Scratching-Paper.mp3"),soundbox.load("pickup7a","/100-movies/assets/sound/Pickup_Coin7a.mp3"),soundbox.load("pickup7b","/100-movies/assets/sound/Pickup_Coin7b.mp3"),soundbox.load("comp11","/100-movies/assets/sound/STcomp011.wav"),soundbox.load("comp12","/100-movies/assets/sound/STcomp012.wav"),t.forEach(function(t){t.nextElementSibling.classList.remove("hide"),t.querySelector(".waiting").classList.add("hide")})})}();