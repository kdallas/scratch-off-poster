function panelSmarts(y,x){var E=y.parentElement,S=new Image;S.addEventListener("load",function(){function t(){sfxMuted||soundbox.play("scratching",null,null,!0),w.classList.remove("icon-neutral"),w.classList.add("icon-baffled"),w.setAttribute("title",f),g.classList.remove("hide"),function t(){l=setTimeout(function(){s()?(clearTimeout(l),d()):t()},1500)}()}function e(){clearTimeout(l),u.closePath(),s()?d():window.soundbox.stop_all()}function i(t,e){var n=y.getBoundingClientRect();return{x:Math.floor((t-n.left)/(n.right-n.left)*y.width),y:Math.floor((e-n.top)/(n.bottom-n.top)*y.height)}}function a(t,e){u.globalCompositeOperation="destination-out",u.lineJoin="round",u.lineCap="round",u.fillStyle="#000",u.beginPath(),u.arc(t-5,e+10,r,0,2*Math.PI),u.closePath(),u.fill(),u.beginPath(),u.moveTo(t-5,e+10)}function n(t){ajaxPost(encodeURI("action="+t+"&listID="+x+"&movieNo="+b),function(t){"added"===t?(E.setAttribute("data-watched","1"),L=1):"removed"===t&&(E.setAttribute("data-watched","0"),L=0);var e=y.closest(".grid-container.full").querySelector(".watched"),n=parseInt(e.textContent);e.textContent=L?n+1:n-1})}function o(){for(var t=0,e=u.getImageData(0,0,y.width,y.height),n=0,i=e.data.length;n<i;n+=4)0===e.data[n]&&0===e.data[n+1]&&0===e.data[n+2]&&0===e.data[n+3]&&t++;return t/c*100}function s(){return 90<o()||((35<o()||E.classList.contains("multi-img"))&&p.classList.remove("hide"),!1)}function d(){window.soundbox.stop_all(),u.clearRect(0,0,y.width,y.height),y.classList.add("hide"),sfxMuted||soundbox.play("pickup7a"),p.classList.add("hide"),w.classList.remove("icon-baffled"),w.classList.add("icon-checkmark2"),w.setAttribute("title",m),L||n("add")}y.width=S.width,y.height=S.height;var c=y.width*y.height,r=15,l=0,u=y.getContext("2d");u.drawImage(S,0,0,y.width,y.height),u.save();var h="Waiting for something amazing to happen...",m="Well done, you claim to have watched 100% of the entirety of this movie!",f="What do you think you're doing?!",v=E.parentElement.querySelector(".controls"),g=v.querySelector(".icon-cancel-circle");g.setAttribute("title","Restore the scratchable layer!");var p=v.querySelector(".icon-forward2");p.setAttribute("title","Scratch this movie off the lazy way!");var b=E.getAttribute("data-no"),L=parseInt(E.getAttribute("data-watched")),w=null;L?(w=v.querySelector(".icon-checkmark2")).setAttribute("title",m):(w=v.querySelector(".icon-neutral")).setAttribute("title",h),g.addEventListener("click",function(){u.restore(),u.drawImage(S,0,0,y.width,y.height),u.save(),sfxMuted||soundbox.play("pickup7b"),g.classList.add("hide"),p.classList.add("hide"),w.classList.remove("icon-checkmark2","icon-baffled"),w.classList.add("icon-neutral"),w.setAttribute("title",h),y.classList.remove("hide"),L&&n("remove")}),p.addEventListener("click",function(){d(),p.classList.add("hide")}),y.addEventListener("mousedown",t),y.addEventListener("mouseup",e),y.addEventListener("mousemove",function(t){var e,n=i(t.clientX,t.clientY);("buttons"in(e=t)?1===e.buttons:"which"in e?1===e.which:1===e.button)&&a(n.x,n.y)},!1),y.addEventListener("touchstart",t),y.addEventListener("touchend",e),y.addEventListener("touchmove",function(t){t.preventDefault();var e=t.targetTouches[0];if(e){var n=i(e.pageX,e.pageY);a(n.x,n.y)}},!1)}),S.crossOrigin="Anonymous",S.src=E.querySelector("img").src}function switchTab(t,e){var n,i=document.getElementsByClassName("tabcontent");for(n=0;n<i.length;n++)i[n].style.display="none";for(document.getElementById(e).style.display="block",i=document.getElementsByClassName("tabmenu"),n=0;n<i.length;n++)i[n].removeAttribute("aria-selected");var a=document.getElementById(t);a.setAttribute("aria-selected",!0),ajaxPost(encodeURI("activeListID="+a.dataset.list_id))}var sfxMuted=!1,ajaxPost=function(t,e){var n=new XMLHttpRequest;n.open("POST","./"),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.onload=function(){200===n.status&&"failed"===n.responseText?alert("Something went wrong.  Response was: "+n.responseText):200!==n.status?alert("Request failed.  Returned status of: "+n.status):e(n.responseText)},n.send(t)};!function(){var t=document.querySelectorAll(".cards-100-top");t.forEach(function(t){var n=t.nextElementSibling,i=t.querySelector(".waiting"),a=t.querySelector(".userCode > input"),o=t.querySelector(".button");a.addEventListener("keyup",function(t){if("Enter"===t.key){i.classList.remove("hide"),o.classList.add("hide");var e=a.getAttribute("data-code");ajaxPost(encodeURI("codeInput="+a.value+"&listID="+n.dataset.id),function(t){t!==e.toUpperCase()?document.location.reload(!0):(o.classList.remove("hide"),i.classList.add("hide"),a.value=e)})}}),o.addEventListener("click",function(){i.classList.remove("hide"),o.classList.add("hide"),ajaxPost(encodeURI("codeRequest=1&listID="+n.dataset.id),function(){document.location.reload(!0)})}),n.querySelectorAll("canvas").forEach(function(t){panelSmarts(t,n.dataset.id)})}),document.querySelectorAll(".tabmenu").forEach(function(t){t.addEventListener("click",function(){switchTab(this.getAttribute("id"),this.getAttribute("data-id"))})});var e=document.getElementById("mute-btn");e.addEventListener("click",function(){e.classList.contains("icon-volume-high")?(window.soundbox.stop_all(),sfxMuted=!0,e.classList.remove("icon-volume-high"),e.classList.add("icon-volume-mute2"),e.title="Unmute"):(sfxMuted=!1,e.classList.remove("icon-volume-mute2"),e.classList.add("icon-volume-high"),e.title="Mute")}),window.addEventListener("load",function(){window.soundbox=new SoundBox,soundbox.load("scratching","/100-movies/assets/sound/Scratching-Paper.mp3"),soundbox.load("pickup7a","/100-movies/assets/sound/Pickup_Coin7a.mp3"),soundbox.load("pickup7b","/100-movies/assets/sound/Pickup_Coin7b.mp3"),t.forEach(function(t){t.nextElementSibling.classList.remove("hide"),t.querySelector(".waiting").classList.add("hide")})})}();